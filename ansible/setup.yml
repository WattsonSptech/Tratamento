- hosts: ec2  # Replace with your inventory group or hostname
  become: true                # This ensures tasks run with elevated privileges (sudo)
  vars:
    project_dir: /home/ubuntu/tratamento
    ansible_python_interpreter: /usr/bin/python3
  tasks:

  tasks:
    - name: Install OpenJDK on Debian/Ubuntu
      hosts: your_target_hosts
      become: true
      tasks:
        - name: Install OpenJDK 11 JDK
          ansible.builtin.apt:
            name: openjdk-11-jdk
            update_cache: yes
            state: present

    - name: Instala Python 3
      apt:
        name: python3
        state: present

    - name: Instala pip
      command: python3 -m ensurepip

    - name: Instala PySpark via pip
      pip:
        name: pyspark
        executable: pip3

    - name: Cria diretório do projeto na EC2
      file:
        path: "{{ project_dir }}"
        state: directory
        mode: "0755"

    - name: Copia todo o projeto "tratamento/" para a EC2
      copy:
        src: ../tratamento/
        dest: "{{ project_dir }}/"
        mode: "0755"

    - name: Instala dependências via requirements.txt
      pip:
        requirements: "{{ project_dir }}/requirements.txt"
        executable: pip3

    - name: Executa o main.py do projeto
      command: python3 "{{ project_dir }}/Main.py"
